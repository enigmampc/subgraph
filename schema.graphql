type EnigmaState @entity {
  " Always equals to 'current'"
  id: ID!

  " Epoch size in number of blocks "
  epochSize: BigInt!

  " Most recent epoch "
  latestEpoch: Epoch
}

type Epoch @entity {
  " Epoch nonce "
  id: ID!

  " Block number principal node is attempting to set worker params "
  inclusionBlockNumber: BigInt!

  " Locally-computed first block number of epoch "
  startBlockNumber: BigInt!

  " Last block number of epoch. Calculated as start_block + epoch_size "
  completeBlockNumber: BigInt!

  " The random integer generated by the enclave "
  seed: BigInt!

  " Creation timestamp as seconds "
  startTime: BigInt!

  " Active workers in the epoch "
  workers: [WorkerSelection!]! @derivedFrom(field: "epoch")
}

type SecretContract @entity {
  " Equals to: <taskId> "
  id: ID!

  " Contract address "
  address: Bytes!

  " Deployed bytecode hash "
  codeHash: Bytes!

  " Initial state delta hash as a result of the contract's constructor "
  initStateDeltaHash: Bytes!

  " Creation timestamp as seconds "
  createdAt: BigInt!

  " Creation block number "
  createdAtBlock: BigInt!

  " Creation transaction hash "
  createdAtTransaction: Bytes!
}

type Task @entity {
  " Task ID "
  id: ID!

  " Inputs hash of encryptedFn, encryptedArgs, and contract address/preCodeHash "
  inputsHash: Bytes!

  " Output hash of task computation "
  outputHash: Bytes

  " ENG gas limit units "
  gasLimit: BigDecimal!

  " ENG gas px in grains (10 ** 8) amount "
  gasPx: BigDecimal!

  " Sender address "
  sender: Bytes!

  " Task status "
  status: TaskStatus!

  " Creation timestamp as seconds "
  createdAt: BigInt!

  " Creation block number "
  createdAtBlock: BigInt!

  " Creation transaction hash "
  createdAtTransaction: Bytes!
}

enum TaskStatus {
  RecordUndefined
  RecordCreated
  ReceiptVerified
  ReceiptFailedENG
  ReceiptFailedETH
  ReceiptFailedReturn
}

" The data representation of a worker (or node) "
type Worker @entity {
  " Equals to: <custodianAddress> "
  id: ID!

  " ENG balance of worker "
  balance: BigDecimal!

  " The worker's custodian address "
  custodianAddress: Bytes!

  " The signer address, derived from the enclave public key "
  signerAddress: Bytes!

  " Worker status "
  status: WorkerStatus!

  " Creation timestamp as seconds "
  createdAt: BigInt!

  " Creation block number "
  createdAtBlock: BigInt!

  " Creation transaction hash "
  createdAtTransaction: Bytes!

  " Epochs in with the worker was active "
  epochs: [WorkerSelection!]! @derivedFrom(field: "worker")

  " Logs containing info regarding updates in worker status "
  logs: [WorkerLog!]! @derivedFrom(field: "worker")
}

" Worker parameters in an epoch "
type WorkerSelection @entity {
  " Equals to: <epochNonce>-<workerId> "
  id: ID!

  " Epoch "
  epoch: Epoch!

  " Worker "
  worker: Worker!

  " Worker's stake "
  stake: BigDecimal!
}

enum WorkerStatus {
  Unregistered
  LoggedIn
  LoggedOut
}

" Info regarding updates in a worker status "
type WorkerLog @entity {
  id: ID!

  " Worker ID "
  worker: Worker!

  " Worker log type "
  type: WorkerLogType!

  " ENG balance of worker "
  balance: BigDecimal!

  " Block number "
  timestamp: BigInt!

  " Block number "
  block: BigInt!

  " Block number "
  transaction: Bytes!
}

enum WorkerLogType {
  Undefined
  LogIn
  LogOut
  Compound
}
