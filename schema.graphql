type EnigmaState @entity {
  " Always equals to 'current'"
  id: ID!

  " Epoch size in number of blocks "
  epochSize: BigInt!

  " Most recent epoch "
  latestEpoch: Epoch

  " Number of created Tasks "
  taskCount: BigInt!

  " Number of completed Tasks "
  completedTaskCount: BigInt!

  " Number of failed Tasks "
  failedTaskCount: BigInt!

  " Number of Workers "
  workerCount: BigInt!
}

type Epoch @entity {
  " Epoch nonce "
  id: ID!

  " Order number "
  order: BigInt!

  " Block number principal node is attempting to set worker params "
  inclusionBlockNumber: BigInt!

  " Locally-computed first block number of epoch "
  startBlockNumber: BigInt!

  " The random integer generated by the enclave "
  seed: BigInt!

  " Creation timestamp as seconds "
  startTime: BigInt!

  " End timestamp as seconds "
  endTime: BigInt!

  " Number of active workers "
  workerCount: BigInt!

  " Active workers in the epoch "
  workers: [Worker!]!

  " ENG gas used during this epoch"
  gasUsed: BigInt

  " ENG reward "
  reward: BigDecimal

  " Number of created Tasks "
  taskCount: BigInt!

  " Number of completed Tasks "
  completedTaskCount: BigInt!

  " Number of failed Tasks "
  failedTaskCount: BigInt!

  " Number of unique Users for this Epoch "
  userCount: BigInt

  " List of unique addresses using this SC "
  users: [String!]

  " Tasks created in the epoch "
  tasks: [Task!] @derivedFrom(field: "epoch")
}

type SecretContract @entity {
  " Equals to: <taskId> "
  id: ID!

  " Contract address "
  address: Bytes!

  " Deployed bytecode hash "
  codeHash: Bytes!

  " Initial state delta hash as a result of the contract's constructor "
  initStateDeltaHash: Bytes!

  " Number of Tasks using this SC"
  taskCount: BigInt

  " Number of unique Users using this SC "
  userCount: BigInt

  " List of unique addresses using this SC "
  users: [String!]

  " Creation timestamp as seconds "
  createdAt: BigInt!

  " Creation block number "
  createdAtBlock: BigInt!

  " Creation transaction hash "
  createdAtTransaction: Bytes!
}

type Task @entity {
  " Task ID "
  id: ID!

  " Order number "
  order: BigInt!

  " Inputs hash of encryptedFn, encryptedArgs, and contract address/preCodeHash "
  inputsHash: Bytes!

  " Output hash of task computation "
  outputHash: Bytes

  " ENG gas limit units "
  gasLimit: BigDecimal!

  " ENG gas px in grains (10 ** 8) amount "
  gasPrice: BigDecimal!

  " ENG gas used "
  gasUsed: BigInt

  " Sender address "
  sender: Bytes!

  " Task status "
  status: TaskStatus!

  " Secret contract address "
  secretContract: SecretContract

  " Ethereum contract address "
  optionalEthereumContractAddress: Bytes

  " Worker "
  worker: Worker

  " Epoch "
  epoch: Epoch

  " Creation timestamp as seconds "
  createdAt: BigInt!

  " Creation block number "
  createdAtBlock: BigInt!

  " Creation transaction hash "
  createdAtTransaction: Bytes!

  " Last status change (complete or fail) timestamp as seconds "
  modifiedAt: BigInt

  " Last status change (complete or fail) block number "
  modifiedAtBlock: BigInt

  " Last status change (complete or fail) transaction hash "
  modifiedAtTransaction: Bytes
}

enum TaskStatus {
  RecordUndefined
  RecordCreated
  ReceiptVerified
  ReceiptFailed
  ReceiptFailedETH
  ReceiptFailedReturn
}

" The data representation of a worker (or node) "
type Worker @entity {
  " Equals to: <custodianAddress> "
  id: ID!

  " ENG balance of worker "
  balance: BigDecimal!

  " The worker's custodian address "
  custodianAddress: Bytes!

  " The signer address, derived from the enclave public key "
  signerAddress: Bytes!

  " Worker status "
  status: WorkerStatus!

  " Creation timestamp as seconds "
  createdAt: BigInt!

  " Creation block number "
  createdAtBlock: BigInt!

  " Creation transaction hash "
  createdAtTransaction: Bytes!

  " Number of Epochs in which the worker was active "
  epochCount: BigInt!

  " Epochs in which the worker was active "
  epochs: [Epoch!]!

  " ENG reward "
  reward: BigDecimal

  " Number of completed Tasks "
  completedTaskCount: BigInt!

  " Number of failed Tasks "
  failedTaskCount: BigInt!

  " Tasks worked "
  tasks: [Task!] @derivedFrom(field: "worker")

  " Logs containing info regarding updates in worker status "
  logs: [WorkerLog!] @derivedFrom(field: "worker")
}

" This allows to search workers by their signer address "
type WorkerSigner @entity {
  " Equals to: <signerAddress> "
  id: ID!

  " The worker's custodian address "
  custodianAddress: Bytes!
}

enum WorkerStatus {
  Unregistered
  LoggedIn
  LoggedOut
}

" Info regarding updates in a worker status "
type WorkerLog @entity {
  id: ID!

  " Worker ID "
  worker: Worker!

  " Worker log type "
  type: WorkerLogType!

  " ENG balance of worker "
  balance: BigDecimal!

  " Block number "
  timestamp: BigInt!

  " Block number "
  block: BigInt!

  " Block number "
  transaction: Bytes!
}

enum WorkerLogType {
  Undefined
  LogIn
  LogOut
  Compound
}
